import{a as mt,b as ct,c as pt,d as lt,e as dt,f as _t,g as gt,h as ft,i as ut,j as xt,k as ht}from"./chunk-CU2S4SOK.js";import{$a as H,Ac as at,B as _,Bc as st,C as g,Ea as y,Ja as N,K as O,Ka as j,M as m,N as x,Na as z,Oa as B,Qa as R,Tb as K,U as l,Vb as Q,Wb as W,Z as f,ca as r,cb as U,d as b,da as s,ea as V,f as L,fa as k,fb as q,ga as F,ia as v,ka as u,kb as G,kc as X,lc as Y,ma as p,oc as Z,pa as S,pc as tt,qa as c,qb as w,qc as et,ra as I,rc as it,sa as M,sb as J,t as h,ua as A,vc as nt,wa as $,x as E,xa as D,xc as ot,y as C,yc as rt,zc as T}from"./chunk-Q2YL65DV.js";function Pt(t,i){if(t&1){let o=v();r(0,"div",7)(1,"mat-form-field")(2,"mat-label"),c(3,"Input post title"),s(),r(4,"input",8),u("ngModelChange",function(e){_(o);let a=p();return g(a.postTitle=e)})("keydown.enter",function(){_(o);let e=p();return g(e.searchPost(e.postTitle))}),s(),r(5,"button",9),u("ngModelChange",function(e){_(o);let a=p();return g(a.postTitle=e)})("click",function(){_(o);let e=p();return g(e.searchPost(e.postTitle))}),r(6,"mat-icon"),c(7,"search"),s()(),r(8,"button",10),u("click",function(){_(o);let e=p();return e.ngOnInit(),g(e.openInput=!1)}),r(9,"mat-icon"),c(10,"close"),s()()()()}if(t&2){let o=p();m(4),l("ngModel",o.postTitle),m(1),l("ngModel",o.postTitle)}}function bt(t,i){t&1&&V(0,"mat-spinner",11)}function St(t,i){if(t&1&&(k(0),r(1,"mat-card-subtitle"),c(2),s(),c(3),F()),t&2){let o=p().$implicit;m(2),M(" ",o.name," "),m(1),M(" ",o.body," ")}}function It(t,i){if(t&1&&(r(0,"p"),f(1,St,4,2,"ng-container",13),s()),t&2){let o=i.$implicit,n=p(2).$implicit;m(1),l("ngIf",o.post_id==n.id)}}function yt(t,i){if(t&1&&(r(0,"div",18)(1,"p",19),c(2,"Comments"),s(),r(3,"mat-card-content"),f(4,It,2,1,"p",14),s()()),t&2){let o=p().$implicit,n=p(3);m(4),l("ngForOf",n.getCommentsForPost(o.id))}}function wt(t,i){t&1&&(r(0,"mat-card-subtitle",20),c(1,"No comments"),s())}function Tt(t,i){if(t&1){let o=v();r(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),c(3),s(),r(4,"mat-card-subtitle"),c(5),s()(),r(6,"mat-card-content")(7,"p"),c(8),s()(),f(9,yt,5,1,"div",15)(10,wt,2,0,"ng-template",null,16,y),r(12,"mat-card-actions")(13,"button",17),u("click",function(){let a=_(o).$implicit,d=p(3);return g(d.addCommentDialog(a.id))}),c(14," Add comment "),r(15,"mat-icon"),c(16,"mode_edit"),s()()()()}if(t&2){let o=i.$implicit,n=S(11),e=p(3);m(3),I(o.title),m(2),M(" ",e.postAuthors.get(o.id)==null?"Anonymous":e.postAuthors.get(o.id)," "),m(3),I(o.body),m(1),l("ngIf",e.hasComments(o.id))("ngIfElse",n)}}function Lt(t,i){if(t&1&&(r(0,"div"),f(1,Tt,17,5,"mat-card",14),$(2,"async"),s()),t&2){let o=p(2);m(1),l("ngForOf",D(2,1,o.posts$))}}function Et(t,i){if(t&1&&(r(0,"div",12),f(1,Lt,3,3,"div",13),s()),t&2){let o=p();m(1),l("ngIf",!o.isLoading)}}var Ot=()=>[10,20,30];function Vt(t,i){if(t&1){let o=v();r(0,"div",21)(1,"mat-paginator",22),u("page",function(e){_(o);let a=p();return g(a.onPageChange(e))}),s()()}if(t&2){let o=p();m(1),l("length",o.postsCount)("pageSize",o.pageSize)("pageSizeOptions",A(4,Ot))("pageIndex",0)}}function kt(t,i){t&1&&(r(0,"h2",20),c(1,"No posts found with this title"),s())}var vt=(()=>{let i=class i{constructor(n,e,a,d,P){this.postsService=n,this.usersService=e,this.dialog=a,this.dialogService=d,this.elementRef=P,this.posts$=b([]),this.comments=[],this.pageSize=10,this.pageNumber=1,this.openInput=!1,this.postTitle="",this.postAuthors=new Map}ngOnInit(){this.isLoading=!0,this.noPosts=!1,this.postTitle="",this.postsService.pageSize=this.pageSize,this.comments=[],this.getPosts("")}getPosts(n){this.postsService.getPosts(n+`&per_page=${this.pageSize}`).subscribe(e=>{if(e.body.length==0)this.noPosts=!0,this.isLoading=!1;else{this.noPosts=!1,this.posts$=b(e.body),this.postsCount=e.count;for(let a of e.body)this.usersService.getUsers(`/${a.user_id}/`).subscribe(d=>{let P=d.body.name;this.postAuthors.set(a.id,P)}),this.getComments(a.id).subscribe(d=>{this.comments.push(...d),this.noPosts=!1,this.isLoading=!1})}})}getComments(n){return this.postsService.getComments(`post_id=${n}`).pipe(L(e=>e.body))}hasComments(n){return this.comments.some(e=>e.post_id===n)}getCommentsForPost(n){return this.comments.filter(e=>e.post_id===n)}searchPost(n){this.comments=[],this.getPosts(`title=${n}`)}addPostDialog(){this.dialogService.dialogTitle="Add new Post",this.dialogService.field1Label="Title",this.dialogService.field2Label="Body",this.dialog.open(T,{enterAnimationDuration:"300ms",exitAnimationDuration:"300ms",width:"100%"})}addCommentDialog(n){this.dialogService.postId=n,this.dialogService.dialogTitle="Add new Comment",this.dialogService.field1Label="Comment",this.dialog.open(T,{enterAnimationDuration:"300ms",exitAnimationDuration:"300ms",width:"100%"})}onPageChange(n){this.comments=[],this.pageSize=n.pageSize,this.pageNumber=n.pageIndex+1,this.getPosts(`title=${this.postTitle}&page=${this.pageNumber}`),this.elementRef.nativeElement.scrollIntoView({behavior:"smooth"})}};i.\u0275fac=function(e){return new(e||i)(x(ot),x(J),x(nt),x(rt),x(O))},i.\u0275cmp=E({type:i,selectors:[["app-post-list"]],decls:16,vars:5,consts:[[1,"button-container"],["mat-raised-button","","color","primary",1,"button",3,"click"],["class","search-container",4,"ngIf"],["diameter","50","style","margin: auto",4,"ngIf"],["class","post-list-container",4,"ngIf","ngIfElse"],["class","pagination-container",4,"ngIf"],["noPostsFound",""],[1,"search-container"],["matInput","","type","text",3,"ngModel","ngModelChange","keydown.enter"],["mat-icon-button","","matSuffix","","color","primary",3,"ngModel","ngModelChange","click"],["mat-icon-button","","matSuffix","","color","warn",3,"click"],["diameter","50",2,"margin","auto"],[1,"post-list-container"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","comments-container",4,"ngIf","ngIfElse"],["noComments",""],["mat-raised-button","","color","primary",3,"click"],[1,"comments-container"],[2,"font-weight","bolder"],[2,"text-align","center"],[1,"pagination-container"],["aria-label","Select page",1,"mat-elevation-z1",3,"length","pageSize","pageSizeOptions","pageIndex","page"]],template:function(e,a){if(e&1&&(r(0,"div",0)(1,"div")(2,"button",1),u("click",function(){return a.addPostDialog()}),c(3," Add post "),r(4,"mat-icon"),c(5,"post_add"),s()(),r(6,"button",1),u("click",function(){return a.openInput=!0}),c(7," Search post "),r(8,"mat-icon"),c(9,"search"),s()()(),f(10,Pt,11,2,"div",2),s(),f(11,bt,1,0,"mat-spinner",3)(12,Et,2,1,"div",4)(13,Vt,2,5,"div",5)(14,kt,2,0,"ng-template",null,6,y)),e&2){let d=S(15);m(10),l("ngIf",a.openInput),m(1),l("ngIf",a.isLoading),m(1),l("ngIf",!a.noPosts)("ngIfElse",d),m(1),l("ngIf",!a.noPosts&&!a.isLoading)}},dependencies:[N,j,H,U,q,dt,ut,gt,xt,ft,_t,K,Q,at,Z,X,Y,mt,et,pt,z],styles:[".post-list-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center}mat-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;max-width:100%;padding:20px;margin:20px}mat-card-title[_ngcontent-%COMP%]{margin-bottom:12px}mat-card-header[_ngcontent-%COMP%]{margin-bottom:20px}mat-card-content[_ngcontent-%COMP%]{margin-bottom:20px}.comments-container[_ngcontent-%COMP%]{padding:15px;margin:0 16px;background-color:#e9f5ff;border-radius:5px;display:flex;flex-direction:column}button[_ngcontent-%COMP%]{margin:20px auto auto}.button-container[_ngcontent-%COMP%]{padding-bottom:10px;margin:0 20px;display:flex;flex-wrap:wrap;justify-content:space-between}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:5px;margin-right:8px}.search-container[_ngcontent-%COMP%]{margin-top:10px}.pagination-container[_ngcontent-%COMP%]{text-align:center;padding-bottom:20px}mat-paginator[_ngcontent-%COMP%]{margin:20px;padding-bottom:10px}.search-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}"]});let t=i;return t})();var Ft=[{path:"",component:vt}],Mt=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=C({type:i}),i.\u0275inj=h({imports:[w.forChild(Ft),w]});let t=i;return t})();var _e=(()=>{let i=class i{};i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=C({type:i}),i.\u0275inj=h({imports:[B,R,Mt,G,ht,W,st,tt,ct,it,lt]});let t=i;return t})();export{_e as PostsModule};
